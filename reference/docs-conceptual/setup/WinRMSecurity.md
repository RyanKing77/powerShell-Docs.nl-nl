---
ms.date: 06/05/2017
keywords: PowerShell-cmdlet
title: WinRMSecurity
ms.openlocfilehash: 59717e4806857e6760de523335bbee6028da8e84
ms.sourcegitcommit: 221b7daab7f597f8b2e4864cf9b5d9dda9b9879b
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 11/27/2018
ms.locfileid: "52320547"
---
# <a name="powershell-remoting-security-considerations"></a><span data-ttu-id="d63ca-103">Beveiligingsoverwegingen bij externe communicatie van PowerShell</span><span class="sxs-lookup"><span data-stu-id="d63ca-103">PowerShell Remoting Security Considerations</span></span>

<span data-ttu-id="d63ca-104">Externe communicatie van PowerShell is de aanbevolen manier om Windows-systemen worden beheerd.</span><span class="sxs-lookup"><span data-stu-id="d63ca-104">PowerShell Remoting is the recommended way to manage Windows systems.</span></span> <span data-ttu-id="d63ca-105">Externe communicatie van PowerShell is standaard ingeschakeld in Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="d63ca-105">PowerShell Remoting is enabled by default in Windows Server 2012 R2.</span></span> <span data-ttu-id="d63ca-106">Dit document bevat informatie over beveiligingsproblemen, aanbevelingen en aanbevolen procedures bij het gebruik van PowerShell voor externe toegang.</span><span class="sxs-lookup"><span data-stu-id="d63ca-106">This document covers security concerns, recommendations, and best practices when using PowerShell Remoting.</span></span>

## <a name="what-is-powershell-remoting"></a><span data-ttu-id="d63ca-107">Wat is de externe communicatie van PowerShell?</span><span class="sxs-lookup"><span data-stu-id="d63ca-107">What is PowerShell Remoting?</span></span>

<span data-ttu-id="d63ca-108">Maakt gebruik van PowerShell voor externe toegang [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), dit is de Microsoft-implementatie van de [Web Services for Management (WS-Management)](https://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) -protocol, waarmee gebruikers PowerShell ook uitvoeren de opdrachten op externe computers.</span><span class="sxs-lookup"><span data-stu-id="d63ca-108">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), which is the Microsoft implementation of the [Web Services for Management (WS-Management)](https://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protocol, to allow users to run PowerShell commands on remote computers.</span></span> <span data-ttu-id="d63ca-109">U vindt meer informatie over het gebruik van PowerShell voor externe toegang op [externe opdrachten uitgevoerd](https://technet.microsoft.com/library/dd819505.aspx).</span><span class="sxs-lookup"><span data-stu-id="d63ca-109">You can find more information about using PowerShell Remoting at [Running Remote Commands](https://technet.microsoft.com/library/dd819505.aspx).</span></span>

<span data-ttu-id="d63ca-110">PowerShell voor externe toegang is niet hetzelfde als wanneer u de **ComputerName** parameter van een cmdlet uit te voeren op een externe computer, waardoor Remote Procedure Call (RPC) gebruikt als het onderliggende protocol.</span><span class="sxs-lookup"><span data-stu-id="d63ca-110">PowerShell Remoting is not the same as using the **ComputerName** parameter of a cmdlet to run it on a remote computer, which uses Remote Procedure Call (RPC) as its underlying protocol.</span></span>

## <a name="powershell-remoting-default-settings"></a><span data-ttu-id="d63ca-111">Standaardinstellingen voor externe communicatie van PowerShell</span><span class="sxs-lookup"><span data-stu-id="d63ca-111">PowerShell Remoting default settings</span></span>

<span data-ttu-id="d63ca-112">PowerShell voor externe toegang (en WinRM) luisteren op de volgende poorten:</span><span class="sxs-lookup"><span data-stu-id="d63ca-112">PowerShell Remoting (and WinRM) listen on the following ports:</span></span>

- <span data-ttu-id="d63ca-113">HTTP: 5985</span><span class="sxs-lookup"><span data-stu-id="d63ca-113">HTTP: 5985</span></span>
- <span data-ttu-id="d63ca-114">HTTPS: 5986</span><span class="sxs-lookup"><span data-stu-id="d63ca-114">HTTPS: 5986</span></span>

<span data-ttu-id="d63ca-115">Standaard staat PowerShell voor externe toegang alleen verbindingen van leden van de groep Administrators.</span><span class="sxs-lookup"><span data-stu-id="d63ca-115">By default, PowerShell Remoting only allows connections from members of the Administrators group.</span></span> <span data-ttu-id="d63ca-116">Sessies worden gestart in de context van de gebruiker, zodat alle besturingssysteem-toegangsbeheer wordt toegepast op afzonderlijke gebruikers en groepen toepassen op deze blijven terwijl u bent verbonden via externe communicatie van PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d63ca-116">Sessions are launched under the user's context, so all operating system access controls applied to individual users and groups continue to apply to them while connected over PowerShell Remoting.</span></span>

<span data-ttu-id="d63ca-117">Op particuliere netwerken accepteert de standaardregel voor de Windows Firewall voor externe communicatie van PowerShell alle verbindingen.</span><span class="sxs-lookup"><span data-stu-id="d63ca-117">On private networks, the default Windows Firewall rule for PowerShell Remoting accepts all connections.</span></span> <span data-ttu-id="d63ca-118">Op openbare netwerken, de standaard Windows Firewall-regel PowerShell voor externe toegang alleen verbindingen via toegestaan binnen hetzelfde subnet.</span><span class="sxs-lookup"><span data-stu-id="d63ca-118">On public networks, the default Windows Firewall rule allows PowerShell Remoting connections only from within the same subnet.</span></span> <span data-ttu-id="d63ca-119">U moet expliciet wijzigen die regel voor het openen van PowerShell voor externe toegang op alle verbindingen van een openbaar netwerk.</span><span class="sxs-lookup"><span data-stu-id="d63ca-119">You have to explicitly change that rule to open PowerShell Remoting to all connections on a public network.</span></span>

><span data-ttu-id="d63ca-120">**Waarschuwing:** de firewallregel voor openbare netwerken is bedoeld om de computer beschermen tegen kwaadwillende externe verbindingspogingen.</span><span class="sxs-lookup"><span data-stu-id="d63ca-120">**Warning:** The firewall rule for public networks is meant to protect the computer from potentially malicious external connection attempts.</span></span> <span data-ttu-id="d63ca-121">Wees voorzichtig bij het verwijderen van deze regel.</span><span class="sxs-lookup"><span data-stu-id="d63ca-121">Use caution when removing this rule.</span></span>

## <a name="process-isolation"></a><span data-ttu-id="d63ca-122">Isolatie van het toepassingsproces</span><span class="sxs-lookup"><span data-stu-id="d63ca-122">Process isolation</span></span>

<span data-ttu-id="d63ca-123">Maakt gebruik van PowerShell voor externe toegang [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) voor communicatie tussen computers.</span><span class="sxs-lookup"><span data-stu-id="d63ca-123">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) for communication between computers.</span></span>
<span data-ttu-id="d63ca-124">WinRM wordt uitgevoerd als een service met de Netwerkservice-account en gestart geïsoleerde processen die worden uitgevoerd als gebruikersaccounts PowerShell-exemplaren hosten.</span><span class="sxs-lookup"><span data-stu-id="d63ca-124">WinRM runs as a service under the Network Service account, and spawns isolated processes running as user accounts to host PowerShell instances.</span></span> <span data-ttu-id="d63ca-125">Een exemplaar van PowerShell die worden uitgevoerd als een gebruiker heeft geen toegang tot een proces een instantie van PowerShell wordt uitgevoerd als een andere gebruiker.</span><span class="sxs-lookup"><span data-stu-id="d63ca-125">An instance of PowerShell running as one user has no access to a process running an instance of PowerShell as another user.</span></span>

## <a name="event-logs-generated-by-powershell-remoting"></a><span data-ttu-id="d63ca-126">Logboeken die worden gegenereerd door externe communicatie van PowerShell</span><span class="sxs-lookup"><span data-stu-id="d63ca-126">Event logs generated by PowerShell Remoting</span></span>

<span data-ttu-id="d63ca-127">FireEye is een goed overzicht van de logboeken en andere security aanwijzingen die worden gegenereerd door externe communicatie van PowerShell-sessies, beschikbaar op opgegeven [PowerShell-aanvallen onderzoeken](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span><span class="sxs-lookup"><span data-stu-id="d63ca-127">FireEye has provided a good summary of the event logs and other security evidence generated by PowerShell Remoting sessions, available at [Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span></span>

## <a name="encryption-and-transport-protocols"></a><span data-ttu-id="d63ca-128">Versleuteling en transport protocollen</span><span class="sxs-lookup"><span data-stu-id="d63ca-128">Encryption and transport protocols</span></span>

<span data-ttu-id="d63ca-129">Is het handig om de beveiliging van een externe communicatie van PowerShell-verbinding vanuit twee perspectieven: initiële verificatie en voortdurend communiceren.</span><span class="sxs-lookup"><span data-stu-id="d63ca-129">It is helpful to consider the security of a PowerShell Remoting connection from two perspectives: initial authentication, and ongoing communication.</span></span>

<span data-ttu-id="d63ca-130">Ongeacht het transportprotocol gebruikt (HTTP of HTTPS) codeert PowerShell voor externe toegang altijd alle communicatie na de initiële verificatie met een sessie-AES-256 symmetrische sleutel.</span><span class="sxs-lookup"><span data-stu-id="d63ca-130">Regardless of the transport protocol used (HTTP or HTTPS), PowerShell Remoting always encrypts all communication after initial authentication with a per-session AES-256 symmetric key.</span></span>

### <a name="initial-authentication"></a><span data-ttu-id="d63ca-131">Initiële verificatie</span><span class="sxs-lookup"><span data-stu-id="d63ca-131">Initial authentication</span></span>

<span data-ttu-id="d63ca-132">Verificatie wordt bevestigd dat de identiteit van de client naar de server- of in het ideale geval - de server naar de client.</span><span class="sxs-lookup"><span data-stu-id="d63ca-132">Authentication confirms the identity of the client to the server - and ideally - the server to the client.</span></span>

<span data-ttu-id="d63ca-133">Wanneer een client verbinding maakt met een domeinserver met behulp van de naam van de computer (dat wil zeggen: server01, of server01.contoso.com), het standaard-verificatieprotocol [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span><span class="sxs-lookup"><span data-stu-id="d63ca-133">When a client connects to a domain server using its computer name (i.e.: server01, or server01.contoso.com), the default authentication protocol is [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span></span>
<span data-ttu-id="d63ca-134">Kerberos garandeert de gebruikers-id en de serveridentiteit zonder een of andere vorm van herbruikbare referenties te verzenden.</span><span class="sxs-lookup"><span data-stu-id="d63ca-134">Kerberos guarantees both the user identity and server identity without sending any sort of reusable credential.</span></span>

<span data-ttu-id="d63ca-135">Wanneer een client verbinding maakt met een domeinserver met behulp van het IP-adres of verbinding met een werkgroepserver maakt, is Kerberos-verificatie niet mogelijk.</span><span class="sxs-lookup"><span data-stu-id="d63ca-135">When a client connects to a domain server using its IP address, or connects to a workgroup server, Kerberos authentication is not possible.</span></span> <span data-ttu-id="d63ca-136">In dat geval PowerShell voor externe toegang is afhankelijk van de [NTLM-verificatieprotocol](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span><span class="sxs-lookup"><span data-stu-id="d63ca-136">In that case, PowerShell Remoting relies on the [NTLM authentication protocol](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span></span> <span data-ttu-id="d63ca-137">Het NTLM-verificatieprotocol garandeert de identiteit van de gebruiker zonder een of andere vorm van delegeerbare referentie te verzenden.</span><span class="sxs-lookup"><span data-stu-id="d63ca-137">The NTLM authentication protocol guarantees the user identity without sending any sort of delegable credential.</span></span> <span data-ttu-id="d63ca-138">Om te bewijzen dat gebruikers-id, het NTLM-protocol is vereist dat de client en de server een sessiesleutel van het wachtwoord van gebruikers compute zonder ooit uitwisselen van het wachtwoord zelf.</span><span class="sxs-lookup"><span data-stu-id="d63ca-138">To prove user identity, the NTLM protocol requires that both the client and server compute a session key from the user's password without ever exchanging the password itself.</span></span> <span data-ttu-id="d63ca-139">De server normaal gesproken weet niet het wachtwoord van gebruikers, zodat deze communiceert met de domeincontroller, dit van de gebruiker het wachtwoord en berekent de sessiesleutel voor de server.</span><span class="sxs-lookup"><span data-stu-id="d63ca-139">The server typically does not know the user's password, so it communicates with the domain controller, which does know the user's password and calculates the session key for the server.</span></span>

<span data-ttu-id="d63ca-140">Het NTLM-protocol is echter niet zo is, garantie voor de identiteit van server.</span><span class="sxs-lookup"><span data-stu-id="d63ca-140">The NTLM protocol does not, however, guarantee server identity.</span></span> <span data-ttu-id="d63ca-141">Net als bij alle protocollen die gebruikmaken van NTLM voor verificatie, kan een aanvaller met toegang tot een domein computer-computeraccount aanroepen van de domeincontroller voor het berekenen van een NTLM-sessiesleutel en waardoor voordoen als de server.</span><span class="sxs-lookup"><span data-stu-id="d63ca-141">As with all protocols that use NTLM for authentication, an attacker with access to a domain-joined computer's machine account could invoke the domain controller to compute an NTLM session-key and thereby impersonate the server.</span></span>

<span data-ttu-id="d63ca-142">NTLM-verificatie is standaard uitgeschakeld, maar kan worden toegestaan door een van beide SSL configureren op de doelserver, of door het configureren van de WinRM-TrustedHosts-instelling op de client.</span><span class="sxs-lookup"><span data-stu-id="d63ca-142">NTLM-based authentication is disabled by default, but may be permitted by either configuring SSL on the target server, or by configuring the WinRM TrustedHosts setting on the client.</span></span>

#### <a name="using-ssl-certificates-to-validate-server-identity-during-ntlm-based-connections"></a><span data-ttu-id="d63ca-143">Met behulp van SSL-certificaten voor het valideren van de identiteit van server tijdens verbindingen op basis van NTLM</span><span class="sxs-lookup"><span data-stu-id="d63ca-143">Using SSL certificates to validate server identity during NTLM-based connections</span></span>

<span data-ttu-id="d63ca-144">Omdat het NTLM-protocol voor verificatie kan niet zorgen dat de identiteit van de doelserver (alleen die deze uw wachtwoord al kent), kunt u de doelservers voor het gebruik van SSL voor PowerShell voor externe toegang kunt configureren.</span><span class="sxs-lookup"><span data-stu-id="d63ca-144">Since the NTLM authentication protocol cannot ensure the identity of the target server (only that it already knows your password), you can configure target servers to use SSL for PowerShell Remoting.</span></span> <span data-ttu-id="d63ca-145">Een SSL-certificaat toewijzen aan de doelserver (als dat is uitgegeven door een certificeringsinstantie die de client ook vertrouwensrelaties), kunt NTLM-verificatie die de gebruikers-id en de serveridentiteit wordt gegarandeerd.</span><span class="sxs-lookup"><span data-stu-id="d63ca-145">Assigning a SSL certificate to the target server (if issued by a Certificate Authority that the client also trusts) enables NTLM-based authentication that guarantees both the user identity and server identity.</span></span>

#### <a name="ignoring-ntlm-based-server-identity-errors"></a><span data-ttu-id="d63ca-146">Server NTLM op basis van identiteit fouten worden genegeerd</span><span class="sxs-lookup"><span data-stu-id="d63ca-146">Ignoring NTLM-based server identity errors</span></span>

<span data-ttu-id="d63ca-147">Als een SSL-certificaat implementeren op een server voor NTLM-verbindingen onbruikbare is, mag u de resulterende identiteit fouten onderdrukken door de server toe te voegen aan de WinRM **TrustedHosts** lijst.</span><span class="sxs-lookup"><span data-stu-id="d63ca-147">If deploying a SSL certificate to a server for NTLM connections is infeasible, you may suppress the resulting identity errors by adding the server to the WinRM **TrustedHosts** list.</span></span> <span data-ttu-id="d63ca-148">Houd er rekening mee dat de naam van een server toe te voegen aan de TrustedHosts-lijst moet niet worden beschouwd als een vorm van instructie van de betrouwbaarheid van de hosts zichzelf: als het NTLM-protocol voor verificatie kan niet garanderen dat u in feite verbinding met de host maakt zijn verbinding maken met wilde maken.</span><span class="sxs-lookup"><span data-stu-id="d63ca-148">Please note that adding a server name to the TrustedHosts list should not be considered as any form of statement of the trustworthiness of the hosts themselves - as the NTLM authentication protocol cannot guarantee that you are in fact connecting to the host you are intending to connect to.</span></span>
<span data-ttu-id="d63ca-149">In plaats daarvan moet u overwegen de TrustedHosts-instelling moet de lijst met hosts die u onderdrukken van de fout die worden gegenereerd wilt door het niet kan controleren of de identiteit van de server.</span><span class="sxs-lookup"><span data-stu-id="d63ca-149">Instead, you should consider the TrustedHosts setting to be the list of hosts for which you wish to suppress the error generated by being unable to verify the server's identity.</span></span>


### <a name="ongoing-communication"></a><span data-ttu-id="d63ca-150">Verdere communicatie</span><span class="sxs-lookup"><span data-stu-id="d63ca-150">Ongoing Communication</span></span>

<span data-ttu-id="d63ca-151">Zodra de initiële verificatie is voltooid, de [PowerShell Remoting Protocol](https://msdn.microsoft.com/library/dd357801.aspx) versleutelt alle verdere communicatie met een sessie-AES-256 symmetrische sleutel.</span><span class="sxs-lookup"><span data-stu-id="d63ca-151">Once initial authentication is complete, the [PowerShell Remoting Protocol](https://msdn.microsoft.com/library/dd357801.aspx) encrypts all ongoing communication with a per-session AES-256 symmetric key.</span></span>


## <a name="making-the-second-hop"></a><span data-ttu-id="d63ca-152">De tweede hop maken</span><span class="sxs-lookup"><span data-stu-id="d63ca-152">Making the second hop</span></span>

<span data-ttu-id="d63ca-153">Standaard gebruikt PowerShell Remoting Kerberos (indien beschikbaar) of NTLM voor authenticatie.</span><span class="sxs-lookup"><span data-stu-id="d63ca-153">By default, PowerShell Remoting uses Kerberos (if available) or NTLM for authentication.</span></span> <span data-ttu-id="d63ca-154">Beide van deze protocollen worden geverifieerd bij de externe computer zonder referenties te verzenden naar deze.</span><span class="sxs-lookup"><span data-stu-id="d63ca-154">Both of these protocols authenticate to the remote machine without sending credentials to it.</span></span>
<span data-ttu-id="d63ca-155">Dit is de veiligste manier om te verifiëren, maar omdat de externe computer geen referenties van de gebruiker heeft geen toegang tot andere computers en services namens de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="d63ca-155">This is the most secure way to authenticate, but because the remote machine does not have the user's credentials, it cannot access other computers and services on the user's behalf.</span></span>
<span data-ttu-id="d63ca-156">Dit staat bekend als het 'tweede hop '-probleem.</span><span class="sxs-lookup"><span data-stu-id="d63ca-156">This is known as the "second hop problem".</span></span>

<span data-ttu-id="d63ca-157">Er zijn verschillende manieren om dit probleem te voorkomen.</span><span class="sxs-lookup"><span data-stu-id="d63ca-157">There are several ways to avoid this problem.</span></span> <span data-ttu-id="d63ca-158">Zie voor beschrijvingen van deze methoden, en de voor- en nadelen van elk [de tweede hop maken in PowerShell Remoting](PS-remoting-second-hop.md).</span><span class="sxs-lookup"><span data-stu-id="d63ca-158">For descriptions of these methods, and the pros and cons of each, see [Making the second hop in PowerShell Remoting](PS-remoting-second-hop.md).</span></span>